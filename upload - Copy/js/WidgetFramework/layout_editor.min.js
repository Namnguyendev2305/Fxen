!function(e,t){var r={renderStart:function(r){if(!r._hasRenderData)return!1;var i={};for(var o in r)if(r.hasOwnProperty(o))switch(typeof r[o]){case"object":case"array":break;default:i[o]=r[o]}XenForo.ajax(t.location.href,e.extend(i,{_layoutEditor:1,_xfResponseType:"html"}),e.context(this,"renderSuccess"),{type:"GET"})},renderSuccess:function(t){if(XenForo.hasResponseError(t))return!1;if(!t.rendered)return!1;var r=this;new XenForo.ExtLoader(t,function(){for(var i in t.rendered)t.rendered.hasOwnProperty(i)&&r.renderSuccess_deleteById(i);for(var o in t.rendered)t.rendered.hasOwnProperty(o)&&t.rendered[o]&&r.renderSuccess_insertRendered(e(t.rendered[o]))})},renderSuccess_insertRendered:function(t){var r=t.data("position"),i=null;if(e(".WidgetFramework_LayoutEditor_Area").each(function(){var t=e(this);if(t.data("position")==r)return i=t.children(".widgets"),!1}),null===i)return!1;var o=t.data("parentGroupId");if(o){var a=i.find("#layout-editor-"+o);1==a.length&&(i=a.children(".widgets"))}var n=parseInt(t.data("widgetId")),d=parseInt(t.data("displayOrder")),s=!1;return i.children().each(function(){var r=e(this),i=parseInt(r.data("widgetId")),o=parseInt(r.data("displayOrder"));if(o>d||o==d&&i>n)return t.xfInsert("insertBefore",r,"show"),s=!0,!1}),s||t.xfInsert("appendTo",i,"show"),!0},renderSuccess_deleteById:function(t){if(!t)return!1;var r=e("#layout-editor-"+t);if(0==r.length)return!1;var i=r.closest(".widgets");return r.attr("id",""),r.empty().xfRemove("",function(){if(0==i.children("[id]").length){var e=i.closest(".controls-parent");e.is(".WidgetFramework_LayoutEditor_Group")&&e.empty().xfRemove()}}),!0}};XenForo.WidgetFramework_LayoutEditor_WidgetLink=function(e){this.__construct(e)},XenForo.WidgetFramework_LayoutEditor_WidgetLink.prototype=e.extend({},r,{__construct:function(t){this.$link=t,t.click(e.context(this,"click"))},click:function(t){if(t.ctrlKey||t.shiftKey||t.altKey)return!0;if(t.which>1)return!0;if(t.preventDefault(),!this.$widgets){var r=this.$link.closest(".controls-parent"),i=null;(i=r.is(".WidgetFramework_LayoutEditor_Widget")?r.closest(".widget-container"):r).is(".WidgetFramework_LayoutEditor_Group")?this.$widgets=i.children().children(".widgets"):i.is(".WidgetFramework_LayoutEditor_Area")&&(this.$widgets=i.children(".widgets"))}if(this.$link.is(".NoOverlay"))return XenForo.ajax(this.$link.attr("href"),{},e.context(this,"renderStart")),!0;if(!this.OverlayLoader){var o=this.$link.attr("href");o+="&_layoutEditor=1",this.$link.data("href",o);var a={onClose:e.context(this,"deCache"),speed:XenForo.speed.fast};return this.OverlayLoader=new XenForo.OverlayLoader(this.$link,!1,a),this.OverlayLoader.load(e.context(this,"overlaySuccess")),!0}this.OverlayLoader.show()},overlaySuccess:function(){if(!this.OverlayLoader||!this.OverlayLoader.overlay)return!0;var e=this,r=this.OverlayLoader.overlay;r.getOverlay().find("form.AutoValidator").bind({AutoValidationComplete:function(i){i.ajaxData._hasRenderData&&(i.preventDefault(),r.close(),e.$link.data("simple")?t.location.reload():e.renderStart(i.ajaxData))}})},deCache:function(){this.OverlayLoader&&this.OverlayLoader.overlay&&(this.OverlayLoader.overlay.getTrigger().removeData("overlay"),this.OverlayLoader.overlay.getOverlay().empty().remove()),delete this.OverlayLoader}}),XenForo.WidgetFramework_LayoutEditor_ButtonLink=function(e){this.__construct(e)},XenForo.WidgetFramework_LayoutEditor_ButtonLink.prototype={__construct:function(t){this.$link=t,t.click(e.context(this,"click"))},click:function(t){var r=e('<div class="xenForm formOverlay" />'),i=e("<ul />").appendTo(r);e(".WidgetFramework_LayoutEditor_AreaSimple").each(function(){var t=e(this);e("<a />").addClass("wf-le-widget-link").attr("href",t.data("href")).text(t.data("position")).data("simple",!0).appendTo(e("<li />")).parent().appendTo(i)}),XenForo.createOverlay(this.$link,r).load(),t.preventDefault()}},XenForo.WidgetFramework_LayoutEditor_Widgets=function(e){var t=null,r=null;if(e.is(".widgets"))r=e;else if(t=e,0==(r=t.closest(".widgets")).length)return;var i=!1,o=r.parent();if(o.is(".WidgetFramework_LayoutEditor_Area")?i=!0:o.is(".WidgetFramework_LayoutEditor_Group")&&(i=!0),i&&(t&&t.css("display","block"),!r.data("WidgetFramework_LayoutEditor_Widgets")))return this.__construct(r,o)},XenForo.WidgetFramework_LayoutEditor_Widgets.prototype=e.extend({},r,{__construct:function(t,r){return t.addClass("dnd-widgets"),this.$widgets=t,this.$parent=r,this.parentIsArea=r.is(".WidgetFramework_LayoutEditor_Area"),t.data("WidgetFramework_LayoutEditor_Widgets",this),t.sortable({connectWith:".dnd-widgets",cursor:"move",handle:".dnd-handle",tolerance:"pointer",out:e.context(this,"onOut"),over:e.context(this,"onOver"),update:e.context(this,"onUpdate")}),!0},onOut:function(){this.$widgets.removeClass("dnd-over")},onOver:function(){(this.parentIsArea?this.$parent:this.$parent.closest(".WidgetFramework_LayoutEditor_Area")).find(".dnd-over").removeClass("dnd-over"),this.$widgets.addClass("dnd-over")},onUpdate:function(t,r){var i=r.item,o=!1;if(this.$widgets.children().each(function(){if(i.is(this))return o=!0,!1}),o){var a=parseInt(i.data("widgetId"));if(!a)return!1;var n=0;this.$widgets.children().each(function(){if(!i.is(this)){var t=e(this);parseInt(t.data("displayOrder"))<0&&n++}});var d=0;n>0&&(d=-1*n-1),this.$widgets.children().each(function(){if(i.is(this))return!1;d=Math.max(0,d+1)});var s=e.context(this,"saveSuccess");XenForo.ajax(this.$parent.data("save"),{widget_id:a,relative_display_order:d,_layoutEditor:1},function(e){s(e)})}else if(0==this.$widgets.children().length){var l=this.$widgets.closest(".controls-parent");l.is(".WidgetFramework_LayoutEditor_Group")&&l.empty().xfRemove()}},saveSuccess:function(e){this.renderStart(e)}}),XenForo.register("a.wf-le-widget-link","XenForo.WidgetFramework_LayoutEditor_WidgetLink"),XenForo.register("a.wf-le-button-link","XenForo.WidgetFramework_LayoutEditor_ButtonLink"),XenForo.register("a.dnd-handle","XenForo.WidgetFramework_LayoutEditor_Widgets"),XenForo.register(".widgets","XenForo.WidgetFramework_LayoutEditor_Widgets")}(jQuery,this);
//# sourceMappingURL=layout_editor.min.js.map