var XAAMS=window.XAAMS||{};
!function(g,k,h,l){XF.Inserter=XF.extend(XF.Inserter,{__backup:{_amsApplyAppend:"__amsApplyAppend"},_amsApplyAppend:function(a,b,c){if(0>".js-yourArticlesList .js-yourPagesList .js-yourSeriesList .js-browseArticlesList .js-browsePagesList .js-browseSeriesList".split(" ").indexOf(a))this.__amsApplyAppend(a,b,c);else{var e=b.find(".amsArticleList-item--placeholder"),d=c.children();e.length?(d.addClass("amsArticleList-item--placeholder--temp"),this.__amsApplyAppend(a,b,c),setTimeout(function(){d.removeClass("amsArticleList-item--placeholder--temp");
e.remove();XF.layoutChange()},10)):this.__amsApplyAppend(a,b,c)}}});XAAMS.editorButton={init:function(){XAAMS.editorButton.initializeDialog();XF.EditorHelpers.dialogs.ams=new XAAMS.EditorDialogAms("ams");g.FE.COMMANDS.xfCustom_ams&&(g.FE.COMMANDS.xfCustom_ams.callback=XAAMS.editorButton.callback)},initializeDialog:function(){XAAMS.EditorDialogAms=XF.extend(XF.EditorDialog,{cache:!1,$container:null,_init:function(a){a=a.$container;a.on("change",".js-articlesPicker",XF.proxy(this,"pick"));this.$container=
a;g("#xa_ams_editor_dialog_form").submit(XF.proxy(this,"submit"))},_afterShow:function(a){this.tabCounts={yourArticles:0,yourPages:0,yourSeries:0,browseArticles:0,browsePages:0,browseSeries:0}},pick:function(a){var b=this.$container.find(a.currentTarget);a=b.is(":checked");b=b.parent();a?this.checked(b):this.unchecked(b)},checked:function(a,b){a.addClass("is-selected");b=a.closest("ul > li.is-active");var c=this.$container.find(b.data("tab"));b=c.attr("id");c.hasClass("has-selected")||c.addClass("has-selected");
var e=this.$container.find(".js-embedValue"),d=JSON.parse(e.val()),f=a.data("type");a=a.data("id");a=f+"-"+a;d.hasOwnProperty(a)||(d[a]=1,a=c.find(".js-tabCounter"),this.tabCounts[b]+=1,a.text(this.tabCounts[b]),e.val(JSON.stringify(d)))},unchecked:function(a,b){a.removeClass("is-selected");b=a.closest("ul > li.is-active");b=this.$container.find(b.data("tab"));var c=b.attr("id"),e=this.$container.find(".js-embedValue"),d=JSON.parse(e.val()),f=a.data("type");a=a.data("id");a=f+"-"+a;d.hasOwnProperty(a)&&
(delete d[a],a=b.find(".js-tabCounter"),--this.tabCounts[c],this.tabCounts[c]?a.text(this.tabCounts[c]):(a.text(0),b.removeClass("has-selected")),e.val(JSON.stringify(d)))},submit:function(a){a.preventDefault();a=this.ed;var b=this.overlay,c=this.$container.find(".js-embedValue");c=JSON.parse(c.val());var e="",d;for(d in c)if(c.hasOwnProperty(d)){var f=d.split("-");e+=XF.htmlspecialchars("[AMS="+f[0]+", "+parseInt(f[1])+"][/AMS]");e+="<p><br></p>"}a.selection.restore();a.html.insert(e);b.hide()}})},
callback:function(){XF.EditorHelpers.loadDialog(this,"ams")}};g(h).on("editor:first-start",XAAMS.editorButton.init)}(jQuery,window,document);